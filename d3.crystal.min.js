d3.crystal=function(){var t,e,r,n=d3.layout.force(),a=300,i=1e4,s=function(t){return t[Math.floor(t.length*Math.random())]},o=function(t){var e;return d3.select(t).attr("d",function(t){e=t.name}),e},u=function(t,e,r){var n={};r.forEach(function(t){n[o(t)]=t});var a=[n[t]];delete n[t];for(var i,u=t;a.length<r.length;)i=e[t].filter(function(t){return t.target.name in n}),u=i.length>0?s(i).target.name:s(Object.keys(n)),a.push(n[u]),delete n[u];return a.reverse(),a};return n.crystallize_nodes=function(e){return r=d3.select(e[0].parentNode),t=e,this},n.crystallize_links=function(t){return r=d3.select(t[0].parentNode),e=t,link_style["stroke-width"]=e.attr("stroke-width"),link_style.stroke=e.attr("stroke"),link_style.opacity=e.attr("opacity"),this},n.crystallize=function(n){function s(){var t=this.getTotalLength(),e=d3.interpolateString("0,"+t,t+","+t);return function(t){return e(t)}}n&&"iter"in n&&(i=n.iter),n&&"ms"in n&&(a=n.ms),this.start();for(var o=i;o>0;--o)this.tick();this.stop(),t.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}).attr("id",function(t){return t.name}).style("visibility","hidden"),e.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}).attr("id",function(t){return t.source.name+"-"+t.target.name}).style("visibility","hidden");for(var c,l=e[0],f=t[0],y={},o=0;o<l.length;o++)c=d3.select(l[o])[0][0].__data__,c.source.name in y?y[c.source.name].push(c):y[c.source.name]=[c];if(n&&"start_node"in n)var d=u(n.start_node,y,f);else var d=f.map(function(t){return t});var h=d3.svg.line(),v=[],g=[],m=this,p=e,k=t,_=r,x=function(){if(d.length>0){var t=d3.select(d.pop());t.style("visibility","visible");var e;t.attr("d",function(t){e=t});var r=y[e.name];if(r)for(var n,i,o,u=0;u<r.length;u++)n=r[u].source.name+"-"+r[u].target.name,i=[[r[u].source.x,r[u].source.y],[r[u].target.x,r[u].target.y]],o=_.append("path").attr("d",h(i)).attr("class","temp-path").attr("stroke",link_svg_style.stroke).attr("stroke-width",link_svg_style["stroke-width"]).attr("opacity",link_svg_style.opacity).transition().duration(a).attrTween("stroke-dasharray",s).each(function(){d3.select("#"+r[u].target.name).style("visibility","visible")}),g.push(n),v.push(o);d.length>0?setTimeout(x,a):x()}else{g.forEach(function(t){d3.select("#"+t).style("visibility","visible")});for(var c=document.getElementsByClassName("temp-path");c.length>0;)c[0].parentNode.removeChild(c[0]);m.start(),m.on("tick",function(){p.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),k.attr("transform",function(t){return"translate("+[t.x,t.y]+")"})})}};setTimeout(x,1)},n};